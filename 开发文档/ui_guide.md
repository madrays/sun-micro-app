# UI 开发指南

本文档用于统一微应用 UI 开发标准，重点覆盖：

- 固定网格尺寸与计算规则
- `ui-design-lab` 辅助开发工具使用方式
- 可复用的布局与样式最佳实践


## 固定尺寸标准

面板采用固定网格模型，默认参数：

- `unit = 76`（单格边长，单位 px）
- `gap = 22`（格子间距，单位 px）

统一计算公式：

```text
width  = unit * cols + gap * (cols - 1)
height = unit * rows + gap * (rows - 1)
```

> 说明：尺寸命名为 `行x列`，例如 `2x4` 表示 2 行 4 列。

### 常用尺寸对照表

| 尺寸 | 行x列 | 宽度计算 | 高度计算 | 结果 |
|------|------|------|------|------|
| `1x1` | 1x1 | `76*1 + 22*0` | `76*1 + 22*0` | `76 x 76` |
| `1x2` | 1x2 | `76*2 + 22*1` | `76*1 + 22*0` | `174 x 76` |
| `2x1` | 2x1 | `76*1 + 22*0` | `76*2 + 22*1` | `76 x 174` |
| `2x2` | 2x2 | `76*2 + 22*1` | `76*2 + 22*1` | `174 x 174` |
| `2x4` | 2x4 | `76*4 + 22*3` | `76*2 + 22*1` | `370 x 174` |
| `1xfull` | 1x全宽 | 全宽容器 | `76*1 + 22*0` | `full x 76` |


## 尺寸开发策略

建议按「信息密度分层」设计，而不是同一套内容硬缩放：

- `1x1`：仅保留核心信息（标题 + 单个关键数值）
- `1x2` / `2x1`：核心信息 + 一个视觉元素（图标/SVG）
- `2x2`：完整核心信息 + 辅助信息 + 视觉元素
- `2x4`：主信息区 + 扩展信息区，尽量提升可读性与留白质量
- `1xfull`：横向摘要，不堆叠过多子模块

实现方式推荐：

- 每个尺寸单独渲染函数（如 `render1x1`、`render2x4`）
- 每个尺寸单独样式片段（内联 `<style>` 或 `sizeStyle` 对象）
- 小尺寸主动做内容裁剪，不依赖浏览器溢出裁切


## UI 调试工具（ui-design-lab）

`ui-design-lab` 用于做「真实尺寸预览 + 元素级调试 + AI 协作」。

### 启动方式

```bash
cd ui-design-lab
npm install
npm run dev
```

### 核心能力

- 自动扫描仓库微应用（读取 `config/components.config.js`）
- 自动生成 `public/manifest.json` 供预览使用
- 支持前端一键“刷新最新改动”（无需手动执行生成命令）
- 支持单尺寸 / 全尺寸预览
- 支持深浅背景、文字色、昼夜模式模拟
- 支持网格线、元素框线开关
- 点击预览元素即可复制结构与关键样式 JSON
- 预览卡右上角放大镜循环缩放（100% / 125% / 150% / 200%）
- 放大时自动进入单尺寸模式；点击全尺寸恢复正常预览
- 单尺寸/放大模式支持编辑：拖动元素、`+/-` 缩放、`Shift +/-` 字体缩放
- “复制更改”导出 `before/after` 最终差异，便于 AI 精准落地修改

### 调试流程（推荐）

1. 在单尺寸模式定位目标尺寸（例如 `2x2`）。
2. 开启网格线检查对齐、间距、边界。
3. 点击具体元素复制信息，直接发给 AI。
4. 修改组件代码后点击“刷新最新改动”，立即更新预览清单。
5. 需要精调时进入编辑模式（拖动 + 键盘缩放），再复制更改差异给 AI。
6. 切到全尺寸快速做回归检查。

### 版本时间与时区

`manifest` 生成时间建议统一为上海时区，避免团队沟通误差：

- `generatedAt` 使用 `Asia/Shanghai`
- 调试台展示建议格式：`版本时间：YYYY-M-D HH:mm:ss`


## 最佳实践

### 1. 布局稳定性优先

- 外层容器统一 `width: 100%; height: 100%`
- 关键容器统一 `min-width: 0; min-height: 0`
- 明确 `overflow` 策略，不要把溢出当做常态表现

### 2. 文本可读性优先

- 深色背景配浅色文字，浅色背景配深色文字
- 小尺寸减少文案层级，避免“字小且多”
- 数字信息优先使用固定行高，避免上下抖动

### 3. 百分比 + 网格思维

- 用比例切分信息区（如 `40%` 文本 + `60%` 图形）
- 避免硬编码绝对定位堆叠
- 使用统一间距尺度（建议基于 4/8 递进）

### 4. 多尺寸一致性

- 先定义每个尺寸“最少必须显示的信息”
- 大尺寸是增强，不是小尺寸的机械放大
- 同一语义元素在不同尺寸中位置尽量稳定

### 5. SVG / 视觉元素规范

- `viewBox` 必须完整，避免裁切
- 推荐 `width/height: 100%` + `object-fit: contain` 思路
- 小尺寸无法保证可读时应主动隐藏复杂插画


## 发布前检查清单

- [ ] `1x1 / 1x2 / 2x1 / 2x2 / 2x4 / 1xfull`（若支持）逐一验证
- [ ] 深色背景与浅色背景都可读
- [ ] 组件内无遮挡、重叠、滚动条异常
- [ ] 文字不被裁切，关键数据不丢失
- [ ] `ui-design-lab` 下网格线对齐正确
- [ ] 点击元素复制信息可用（便于后续协作定位）


## 常见问题

### 为什么在调试台看到 “未提取到 sizeStyle”？

如果组件采用 `render1x1()/render2x2()` 这类函数内联 `<style>`，就不会存在独立 `sizeStyle` 对象。此时应以真实组件渲染结果为准。

### 什么时候必须用 `1xfull`？

仅当组件确实是横向摘要型信息（如横向天气条）时使用。普通卡片类组件可不声明 `1xfull`。
